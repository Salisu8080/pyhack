<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PyHack - Learn Python Interactively</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #3b82f6;
            --success-color: #059669;
            --warning-color: #d97706;
            --danger-color: #dc2626;
            --light-bg: #f8fafc;
            --dark-bg: #1e293b;
        }

        body {
            background: linear-gradient(135deg, #e0f2fe 0%, #e8eaf6 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .header-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border-bottom: 2px solid var(--primary-color);
        }

        .card-custom {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border: none;
            border-radius: 12px;
            overflow: hidden;
        }

        .progress-custom {
            height: 8px;
            border-radius: 4px;
            background-color: #e5e7eb;
        }

        .progress-bar-custom {
            background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .streak-badge {
            background: linear-gradient(135deg, #fb923c 0%, #f97316 100%);
            color: white;
            border-radius: 25px;
            padding: 8px 16px;
            font-weight: 600;
        }

        .level-card {
            transition: all 0.3s ease;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
        }

        .level-card:hover:not(.disabled) {
            border-color: var(--primary-color);
            background-color: #eff6ff;
            transform: translateY(-2px);
        }

        .level-card.completed {
            border-color: var(--success-color);
            background-color: #f0fdf4;
        }

        .level-card.current {
            border-color: var(--primary-color);
            background-color: #eff6ff;
        }

        .level-card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background-color: #f9fafb;
        }

        .code-editor {
            background-color: #1e293b;
            color: #10b981;
            font-family: 'Courier New', monospace;
            border: none;
            resize: none;
            outline: none;
        }

        .code-editor:focus {
            box-shadow: none;
        }

        .editor-header {
            background-color: #374151;
            color: white;
            padding: 12px 16px;
            border-radius: 8px 8px 0 0;
        }

        .task-card {
            background: linear-gradient(135deg, #eff6ff 0%, #e0f2fe 100%);
            border-left: 4px solid var(--primary-color);
            border-radius: 0 8px 8px 0;
        }

        .hint-card {
            background: linear-gradient(135deg, #fefce8 0%, #fef3c7 100%);
            border-left: 4px solid #eab308;
            border-radius: 0 8px 8px 0;
        }

        .feedback-success {
            background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%);
            border: 1px solid #bbf7d0;
            border-radius: 8px;
        }

        .feedback-error {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border: 1px solid #fecaca;
            border-radius: 8px;
        }

        .feedback-loading {
            background: linear-gradient(135deg, #eff6ff 0%, #e0f2fe 100%);
            border: 1px solid #bfdbfe;
            border-radius: 8px;
        }

        .btn-custom {
            border-radius: 8px;
            font-weight: 600;
            padding: 10px 20px;
            transition: all 0.3s ease;
        }

        .btn-primary-custom {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            border: none;
            color: white;
        }

        .btn-primary-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .btn-success-custom {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
            border: none;
            color: white;
        }

        .btn-success-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
        }

        .modal-content {
            border-radius: 12px;
            border: none;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="bg-white header-shadow sticky-top">
        <div class="container-fluid px-4 py-3">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <div class="d-flex align-items-center">
                        <h1 class="mb-0 me-4" style="color: var(--primary-color); font-weight: 700; font-size: 2rem;">
                            <i class="fas fa-code me-2"></i>PyHack
                        </h1>
                        <div class="d-none d-md-flex align-items-center text-muted">
                            <i class="fas fa-trophy me-2"></i>
                            <span class="fw-bold" id="progress-text">0/15 Levels</span>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="d-flex align-items-center justify-content-end">
                        <div class="streak-badge me-3">
                            <i class="fas fa-fire me-2"></i>
                            <span id="streak-count">0</span>
                            <span class="ms-1">streak</span>
                        </div>
                        <button class="btn btn-primary-custom btn-custom" onclick="toggleLevelSelector()">
                            <i class="fas fa-list me-2"></i>Level <span id="current-level-display">1</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Progress Bar -->
            <div class="row mt-3">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <small class="text-muted">Overall Progress</small>
                        <small class="text-muted" id="progress-percentage">0%</small>
                    </div>
                    <div class="progress progress-custom">
                        <div class="progress-bar progress-bar-custom" id="progress-bar" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Level Selector Modal -->
    <div class="modal fade" id="levelSelectorModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-list-alt me-2"></i>Select Level
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row g-3" id="level-grid">
                        <!-- Level cards will be generated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container-fluid px-4 py-4">
        <div class="row g-4">
            <!-- Left Panel - Instructions -->
            <div class="col-lg-6">
                <div class="card card-custom h-100">
                    <div class="card-body p-4">
                        <!-- Level Info -->
                        <div class="mb-4">
                            <div class="d-flex align-items-center justify-content-between mb-3">
                                <h2 class="card-title mb-0" id="level-title">Level 1: Hello World</h2>
                                <i class="fas fa-check-circle text-success fs-4 d-none" id="completed-icon"></i>
                            </div>
                            <p class="text-muted mb-3" id="level-description">Welcome to Python! Let's start with the traditional first program.</p>
                            
                            <div class="task-card p-3 mb-4">
                                <h6 class="fw-bold text-primary mb-2">
                                    <i class="fas fa-tasks me-2"></i>Task:
                                </h6>
                                <p class="mb-0" id="level-task">Write a program that prints 'Hello, World!' to the console.</p>
                            </div>
                        </div>

                        <!-- Hint Section -->
                        <div class="mb-4">
                            <button class="btn btn-outline-warning btn-sm" onclick="toggleHint()">
                                <i class="fas fa-lightbulb me-2"></i>
                                <span id="hint-toggle-text">Show Hint</span>
                            </button>
                            
                            <div class="hint-card p-3 mt-3 d-none" id="hint-section">
                                <p class="mb-0" id="hint-text">Use the print() function with the text in quotes: print('Hello, World!')</p>
                            </div>
                        </div>

                        <!-- Feedback Section -->
                        <div id="feedback-section" class="d-none">
                            <!-- Feedback content will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Code Editor -->
            <div class="col-lg-6">
                <div class="card card-custom h-100">
                    <div class="editor-header d-flex align-items-center justify-content-between">
                        <h5 class="mb-0">
                            <i class="fas fa-code me-2"></i>Python Code Editor
                        </h5>
                        <div class="d-flex gap-2">
                            <button class="btn btn-outline-light btn-sm" onclick="resetCode()">
                                <i class="fas fa-undo me-1"></i>Reset
                            </button>
                            <button class="btn btn-success btn-sm" onclick="runCode()" id="run-button">
                                <i class="fas fa-play me-1"></i>Run Code
                            </button>
                        </div>
                    </div>
                    <div class="flex-grow-1">
                        <textarea 
                            id="code-editor" 
                            class="code-editor w-100 p-3" 
                            rows="20" 
                            placeholder="Write your Python code here..."
                            spellcheck="false"
                        ># Write your code here</textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                    <button class="btn btn-outline-secondary btn-custom" onclick="previousLevel()" id="prev-button">
                        <i class="fas fa-chevron-left me-2"></i>Previous Level
                    </button>
                    
                    <div class="text-center">
                        <p class="text-muted mb-0" id="level-indicator">Level 1 of 15</p>
                    </div>
                    
                    <button class="btn btn-primary-custom btn-custom" onclick="nextLevel()" id="next-button" disabled>
                        Next Level<i class="fas fa-chevron-right ms-2"></i>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
    <script>
        // Translations and level data
        const TRANSLATIONS = {
            "en-US": {
                "helloWorldTitle": "Hello World",
                "helloWorldDescription": "Welcome to Python! Let's start with the traditional first program.",
                "helloWorldTask": "Write a program that prints 'Hello, World!' to the console.",
                "helloWorldHint": "Use the print() function with the text in quotes: print('Hello, World!')",
                "variablesNumbersTitle": "Variables and Numbers",
                "variablesNumbersDescription": "Learn to store and work with numbers using variables.",
                "variablesNumbersTask": "Create a variable called 'age' with value 25, then print it.",
                "variablesNumbersHint": "Create a variable: age = 25, then print it: print(age)",
                "stringVariablesTitle": "String Variables",
                "stringVariablesDescription": "Work with text data using string variables.",
                "stringVariablesTask": "Create a variable called 'name' with your name, then print 'Hello, [name]!'",
                "stringVariablesHint": "Use string concatenation or f-strings: print(f'Hello, {name}!')",
                "userInputTitle": "User Input",
                "userInputDescription": "Learn to get input from users and respond.",
                "userInputTask": "Ask for the user's favorite color and print 'Your favorite color is [color]'",
                "userInputHint": "Use input() to get user input: color = input('What is your favorite color? ')",
                "basicMathTitle": "Basic Math",
                "basicMathDescription": "Perform mathematical operations in Python.",
                "basicMathTask": "Calculate 15 + 27 and print the result.",
                "basicMathHint": "Use the + operator: print(15 + 27)",
                "conditionalsTitle": "Conditionals",
                "conditionalsDescription": "Make decisions in your code with if statements.",
                "conditionalsTask": "Check if the number 10 is greater than 5. If true, print 'Yes, 10 is greater than 5'",
                "conditionalsHint": "Use if statement: if number > 5: print('Yes, 10 is greater than 5')",
                "forLoopsTitle": "For Loops",
                "forLoopsDescription": "Repeat actions using for loops.",
                "forLoopsTask": "Print numbers from 1 to 3 using a for loop.",
                "forLoopsHint": "Use range(): for i in range(1, 4): print(i)",
                "whileLoopsTitle": "While Loops",
                "whileLoopsDescription": "Use while loops for conditional repetition.",
                "whileLoopsTask": "Print numbers from 1 to 3 using a while loop.",
                "whileLoopsHint": "Increment count each iteration: while count <= 3: print(count); count += 1",
                "listsBasicsTitle": "Lists Basics",
                "listsBasicsDescription": "Store multiple items in lists.",
                "listsBasicsTask": "Create a list with fruits ['apple', 'banana', 'orange'] and print the second item.",
                "listsBasicsHint": "Lists use zero-based indexing: fruits[1] gets the second item",
                "listOperationsTitle": "List Operations",
                "listOperationsDescription": "Add and modify list items.",
                "listOperationsTask": "Create a list [1, 2, 3], add the number 4, then print the entire list.",
                "listOperationsHint": "Use append() method: numbers.append(4), then print(numbers)",
                "functionsBasicsTitle": "Functions Basics",
                "functionsBasicsDescription": "Create reusable code with functions.",
                "functionsBasicsTask": "Define a function called 'greet' that prints 'Hello!' and then call it.",
                "functionsBasicsHint": "Use def keyword: def greet(): print('Hello!'), then call greet()",
                "functionsParametersTitle": "Functions with Parameters",
                "functionsParametersDescription": "Pass data to functions using parameters.",
                "functionsParametersTask": "Create a function 'say_hello' that takes a name parameter and prints 'Hello, [name]!'. Call it with 'World'.",
                "functionsParametersHint": "def say_hello(name): print(f'Hello, {name}!'), then call say_hello('World')",
                "dictionariesTitle": "Dictionaries",
                "dictionariesDescription": "Store key-value pairs using dictionaries.",
                "dictionariesTask": "Create a dictionary with person info: name='Alice', age=30. Print the name.",
                "dictionariesHint": "Use curly braces: person = {'name': 'Alice', 'age': 30}, access with person['name']",
                "stringMethodsTitle": "String Methods",
                "stringMethodsDescription": "Manipulate strings with built-in methods.",
                "stringMethodsTask": "Take the string 'python programming' and print it in uppercase.",
                "stringMethodsHint": "Use the upper() method: text.upper()",
                "finalChallengeTitle": "Final Challenge",
                "finalChallengeDescription": "Combine everything you've learned!",
                "finalChallengeTask": "Create a list of numbers [1,2,3,4,5], use a for loop to print each number multiplied by 2.",
                "finalChallengeHint": "Loop through the list: for num in numbers: print(num * 2)",
                "starterCodeComment": "# Write your code here\n",
                "createVariableComment": "# Create a variable and print it\n",
                "createStringComment": "# Create a string variable\n",
                "getUserInputComment": "# Get user input and respond\n",
                "calculateSumComment": "# Calculate and print the sum\n",
                "useIfStatementComment": "# Use an if statement\nnumber = 10\n",
                "useForLoopComment": "# Use a for loop to print numbers\n",
                "useWhileLoopComment": "# Use a while loop\ncount = 1\n",
                "createListComment": "# Create a list and access items\n",
                "createListAddComment": "# Create list and add item\n",
                "defineFunctionComment": "# Define and call a function\n",
                "functionParameterComment": "# Function with parameter\n",
                "createDictionaryComment": "# Create and use a dictionary\n",
                "stringMethodsComment": "# Use string methods\ntext = 'python programming'\n",
                "finalChallengeComment": "# Final challenge - combine concepts\n"
            }
        };

        const locale = 'en-US';
        const t = (key) => TRANSLATIONS[locale]?.[key] || key;

        // Level definitions
        const levels = [
            {
                id: 1,
                title: t('helloWorldTitle'),
                description: t('helloWorldDescription'),
                task: t('helloWorldTask'),
                starterCode: t('starterCodeComment'),
                expectedOutput: "Hello, World!",
                hint: t('helloWorldHint'),
                solution: "print('Hello, World!')"
            },
            {
                id: 2,
                title: t('variablesNumbersTitle'),
                description: t('variablesNumbersDescription'),
                task: t('variablesNumbersTask'),
                starterCode: t('createVariableComment'),
                expectedOutput: "25",
                hint: t('variablesNumbersHint'),
                solution: "age = 25\nprint(age)"
            },
            {
                id: 3,
                title: t('stringVariablesTitle'),
                description: t('stringVariablesDescription'),
                task: t('stringVariablesTask'),
                starterCode: t('createStringComment'),
                expectedOutput: "Hello, Python!",
                hint: t('stringVariablesHint'),
                solution: "name = 'Python'\nprint(f'Hello, {name}!')"
            },
            {
                id: 4,
                title: t('userInputTitle'),
                description: t('userInputDescription'),
                task: t('userInputTask'),
                starterCode: t('getUserInputComment'),
                expectedOutput: "Your favorite color is blue",
                hint: t('userInputHint'),
                solution: "color = input('What is your favorite color? ')\nprint(f'Your favorite color is {color}')"
            },
            {
                id: 5,
                title: t('basicMathTitle'),
                description: t('basicMathDescription'),
                task: t('basicMathTask'),
                starterCode: t('calculateSumComment'),
                expectedOutput: "42",
                hint: t('basicMathHint'),
                solution: "print(15 + 27)"
            },
            {
                id: 6,
                title: t('conditionalsTitle'),
                description: t('conditionalsDescription'),
                task: t('conditionalsTask'),
                starterCode: t('useIfStatementComment'),
                expectedOutput: "Yes, 10 is greater than 5",
                hint: t('conditionalsHint'),
                solution: "number = 10\nif number > 5:\n    print('Yes, 10 is greater than 5')"
            },
            {
                id: 7,
                title: t('forLoopsTitle'),
                description: t('forLoopsDescription'),
                task: t('forLoopsTask'),
                starterCode: t('useForLoopComment'),
                expectedOutput: "1\n2\n3",
                hint: t('forLoopsHint'),
                solution: "for i in range(1, 4):\n    print(i)"
            },
            {
                id: 8,
                title: t('whileLoopsTitle'),
                description: t('whileLoopsDescription'),
                task: t('whileLoopsTask'),
                starterCode: t('useWhileLoopComment'),
                expectedOutput: "1\n2\n3",
                hint: t('whileLoopsHint'),
                solution: "count = 1\nwhile count <= 3:\n    print(count)\n    count += 1"
            },
            {
                id: 9,
                title: t('listsBasicsTitle'),
                description: t('listsBasicsDescription'),
                task: t('listsBasicsTask'),
                starterCode: t('createListComment'),
                expectedOutput: "banana",
                hint: t('listsBasicsHint'),
                solution: "fruits = ['apple', 'banana', 'orange']\nprint(fruits[1])"
            },
            {
                id: 10,
                title: t('listOperationsTitle'),
                description: t('listOperationsDescription'),
                task: t('listOperationsTask'),
                starterCode: t('createListAddComment'),
                expectedOutput: "[1, 2, 3, 4]",
                hint: t('listOperationsHint'),
                solution: "numbers = [1, 2, 3]\nnumbers.append(4)\nprint(numbers)"
            },
            {
                id: 11,
                title: t('functionsBasicsTitle'),
                description: t('functionsBasicsDescription'),
                task: t('functionsBasicsTask'),
                starterCode: t('defineFunctionComment'),
                expectedOutput: "Hello!",
                hint: t('functionsBasicsHint'),
                solution: "def greet():\n    print('Hello!')\n\ngreet()"
            },
            {
                id: 12,
                title: t('functionsParametersTitle'),
                description: t('functionsParametersDescription'),
                task: t('functionsParametersTask'),
                starterCode: t('functionParameterComment'),
                expectedOutput: "Hello, World!",
                hint: t('functionsParametersHint'),
                solution: "def say_hello(name):\n    print(f'Hello, {name}!')\n\nsay_hello('World')"
            },
            {
                id: 13,
                title: t('dictionariesTitle'),
                description: t('dictionariesDescription'),
                task: t('dictionariesTask'),
                starterCode: t('createDictionaryComment'),
                expectedOutput: "Alice",
                hint: t('dictionariesHint'),
                solution: "person = {'name': 'Alice', 'age': 30}\nprint(person['name'])"
            },
            {
                id: 14,
                title: t('stringMethodsTitle'),
                description: t('stringMethodsDescription'),
                task: t('stringMethodsTask'),
                starterCode: t('stringMethodsComment'),
                expectedOutput: "PYTHON PROGRAMMING",
                hint: t('stringMethodsHint'),
                solution: "text = 'python programming'\nprint(text.upper())"
            },
            {
                id: 15,
                title: t('finalChallengeTitle'),
                description: t('finalChallengeDescription'),
                task: t('finalChallengeTask'),
                starterCode: t('finalChallengeComment'),
                expectedOutput: "2\n4\n6\n8\n10",
                hint: t('finalChallengeHint'),
                solution: "numbers = [1, 2, 3, 4, 5]\nfor num in numbers:\n    print(num * 2)"
            }
        ];

        // Application state
        let currentLevel = 1;
        let completedLevels = new Set();
        let streak = 0;
        let showHint = false;

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            loadState();
            generateLevelGrid();
            loadLevel(currentLevel);
            updateUI();
        });

        // State management
        function saveState() {
            const state = {
                currentLevel,
                completedLevels: Array.from(completedLevels),
                streak
            };
            localStorage.setItem('pyhack-state', JSON.stringify(state));
        }

        function loadState() {
            const savedState = localStorage.getItem('pyhack-state');
            if (savedState) {
                const state = JSON.parse(savedState);
                currentLevel = state.currentLevel || 1;
                completedLevels = new Set(state.completedLevels || []);
                streak = state.streak || 0;
            }
        }

        // UI Functions
        function updateUI() {
            const progressCount = completedLevels.size;
            const progressPercentage = (progressCount / levels.length) * 100;
            
            document.getElementById('progress-text').textContent = `${progressCount}/${levels.length} Levels`;
            document.getElementById('progress-percentage').textContent = `${Math.round(progressPercentage)}%`;
            document.getElementById('progress-bar').style.width = `${progressPercentage}%`;
            document.getElementById('streak-count').textContent = streak;
            document.getElementById('current-level-display').textContent = currentLevel;
            document.getElementById('level-indicator').textContent = `Level ${currentLevel} of ${levels.length}`;
            
            // Update navigation buttons
            document.getElementById('prev-button').disabled = currentLevel === 1;
            document.getElementById('next-button').disabled = !completedLevels.has(currentLevel) || currentLevel === levels.length;
            
            // Update completed icon
            const completedIcon = document.getElementById('completed-icon');
            if (completedLevels.has(currentLevel)) {
                completedIcon.classList.remove('d-none');
            } else {
                completedIcon.classList.add('d-none');
            }
        }

        function loadLevel(levelId) {
            const level = levels.find(l => l.id === levelId);
            if (!level) return;

            document.getElementById('level-title').textContent = `Level ${levelId}: ${level.title}`;
            document.getElementById('level-description').textContent = level.description;
            document.getElementById('level-task').textContent = level.task;
            document.getElementById('hint-text').textContent = level.hint;
            document.getElementById('code-editor').value = level.starterCode;
            
            // Reset UI state
            hideHint();
            hideFeedback();
            updateUI();
        }

        function generateLevelGrid() {
            const grid = document.getElementById('level-grid');
            grid.innerHTML = '';

            levels.forEach(level => {
                const isCompleted = completedLevels.has(level.id);
                const isLocked = level.id > Math.max(1, Math.max(...Array.from(completedLevels)) + 1);
                const isCurrent = level.id === currentLevel;
                
                let cardClass = 'level-card p-3';
                if (isCurrent) cardClass += ' current';
                else if (isCompleted) cardClass += ' completed';
                else if (isLocked) cardClass += ' disabled';

                const card = document.createElement('div');
                card.className = 'col-md-6 col-lg-4';
                card.innerHTML = `
                    <div class="${cardClass}" onclick="${!isLocked ? `changeLevel(${level.id})` : ''}">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <small class="text-muted fw-bold">Level ${level.id}</small>
                            ${isCompleted ? '<i class="fas fa-check-circle text-success"></i>' : 
                              isLocked ? '<i class="fas fa-lock text-muted"></i>' : ''}
                        </div>
                        <h6 class="fw-bold mb-1">${level.title}</h6>
                        <p class="small text-muted mb-0 line-clamp-2">${level.description}</p>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // Level navigation
        function changeLevel(levelId) {
            const maxUnlockedLevel = Math.max(1, Math.max(...Array.from(completedLevels)) + 1);
            if (levelId <= maxUnlockedLevel) {
                currentLevel = levelId;
                loadLevel(currentLevel);
                saveState();
                bootstrap.Modal.getInstance(document.getElementById('levelSelectorModal')).hide();
            }
        }

        function previousLevel() {
            if (currentLevel > 1) {
                changeLevel(currentLevel - 1);
            }
        }

        function nextLevel() {
            if (completedLevels.has(currentLevel) && currentLevel < levels.length) {
                changeLevel(currentLevel + 1);
            }
        }

        // UI Toggles
        function toggleLevelSelector() {
            generateLevelGrid();
            new bootstrap.Modal(document.getElementById('levelSelectorModal')).show();
        }

        function toggleHint() {
            showHint = !showHint;
            const hintSection = document.getElementById('hint-section');
            const toggleText = document.getElementById('hint-toggle-text');
            
            if (showHint) {
                hintSection.classList.remove('d-none');
                toggleText.textContent = 'Hide Hint';
            } else {
                hintSection.classList.add('d-none');
                toggleText.textContent = 'Show Hint';
            }
        }

        function hideHint() {
            showHint = false;
            document.getElementById('hint-section').classList.add('d-none');
            document.getElementById('hint-toggle-text').textContent = 'Show Hint';
        }

        function showFeedback(type, message, details = {}) {
            const feedbackSection = document.getElementById('feedback-section');
            let className, icon;
            
            switch(type) {
                case 'success':
                    className = 'feedback-success';
                    icon = 'fas fa-check-circle text-success';
                    break;
                case 'error':
                    className = 'feedback-error';
                    icon = 'fas fa-times-circle text-danger';
                    break;
                case 'loading':
                    className = 'feedback-loading';
                    icon = 'loading-spinner';
                    break;
                default:
                    className = 'feedback-loading';
                    icon = 'fas fa-info-circle text-info';
            }

            let content = `
                <div class="${className} p-3 mb-4">
                    <p class="fw-bold mb-2">
                        ${type === 'loading' ? '<span class="loading-spinner me-2"></span>' : `<i class="${icon} me-2"></i>`}
                        ${message}
                    </p>
            `;

            if (details.explanation) {
                content += `<div class="mb-2"><p class="small text-muted">${details.explanation}</p></div>`;
            }

            if (details.output) {
                content += `
                    <div class="mb-2">
                        <p class="small text-muted mb-1">Your output:</p>
                        <pre class="bg-light p-2 rounded small"><code>${details.output}</code></pre>
                    </div>
                `;
            }

            if (details.expected) {
                content += `
                    <div class="mb-2">
                        <p class="small text-muted mb-1">Expected output:</p>
                        <pre class="bg-light p-2 rounded small"><code>${details.expected}</code></pre>
                    </div>
                `;
            }

            if (details.hint && type === 'error') {
                content += `
                    <div class="mt-3 p-3 bg-info bg-opacity-10 rounded">
                        <p class="small text-info mb-0"><strong>Tip:</strong> ${details.hint}</p>
                    </div>
                `;
            }

            content += '</div>';
            feedbackSection.innerHTML = content;
            feedbackSection.classList.remove('d-none');
        }

        function hideFeedback() {
            document.getElementById('feedback-section').classList.add('d-none');
        }

        // Code execution
        function executeCode(code) {
            try {
                const printRegex = /print\((.*?)\)/g;
                const matches = [];
                let match;
                
                while ((match = printRegex.exec(code)) !== null) {
                    let value = match[1].trim();
                    
                    if (value.startsWith("'") && value.endsWith("'")) {
                        matches.push(value.slice(1, -1));
                    } else if (value.startsWith('"') && value.endsWith('"')) {
                        matches.push(value.slice(1, -1));
                    } else if (value.match(/^\d+$/)) {
                        matches.push(value);
                    } else if (value.includes('f\'') || value.includes('f"')) {
                        if (code.includes('name = \'Python\'') || code.includes('name = "Python"')) {
                            matches.push(value.replace(/f['"]Hello, \{name\}!['"]/, 'Hello, Python!'));
                        }
                        if (code.includes('color = input(')) {
                            matches.push('Your favorite color is blue');
                        }
                    } else if (value.includes('+')) {
                        try {
                            const result = eval(value);
                            matches.push(result.toString());
                        } catch {
                            matches.push(value);
                        }
                    } else if (code.includes('fruits[1]')) {
                        matches.push('banana');
                    } else if (code.includes('[1, 2, 3, 4]')) {
                        matches.push('[1, 2, 3, 4]');
                    } else if (code.includes('person[\'name\']')) {
                        matches.push('Alice');
                    } else if (code.includes('.upper()')) {
                        matches.push('PYTHON PROGRAMMING');
                    } else {
                        if (code.includes('age = 25')) matches.push('25');
                        if (code.includes('Hello!')) matches.push('Hello!');
                        if (code.includes('Hello, World!')) matches.push('Hello, World!');
                        if (code.includes('Yes, 10 is greater than 5')) matches.push('Yes, 10 is greater than 5');
                    }
                }

                if (code.includes('for i in range(1, 4)')) {
                    matches.push('1', '2', '3');
                }
                if (code.includes('while count <= 3')) {
                    matches.push('1', '2', '3');
                }
                if (code.includes('for num in numbers:') && code.includes('print(num * 2)')) {
                    matches.push('2', '4', '6', '8', '10');
                }

                return matches.join('\n');
            } catch (error) {
                return "Error: " + error.message;
            }
        }

        async function runCode() {
            const level = levels.find(l => l.id === currentLevel);
            const userCode = document.getElementById('code-editor').value;
            
            // Show loading feedback
            showFeedback('loading', 'ðŸ¤” Evaluating your code...');
            
            // Disable run button
            const runButton = document.getElementById('run-button');
            runButton.disabled = true;

            try {
                // Use Claude API for evaluation if available
                if (window.claude && window.claude.complete) {
                    const prompt = `
You are evaluating Python code submissions for a learning platform. Compare the user's code with the expected solution to determine if they are functionally equivalent.

Task: ${level.task}
Expected Output: ${level.expectedOutput}

User's Code:
${userCode}

Expected Solution:
${level.solution}

Evaluate if the user's code will produce the same output as the expected solution. Consider:
1. Does the user's code accomplish the same task?
2. Will it produce the exact same output?
3. Are there any syntax errors?
4. Does it follow reasonable Python practices?

Respond ONLY with a valid JSON object in this exact format:
{
  "isCorrect": true/false,
  "explanation": "Brief explanation of why the code is correct or incorrect",
  "feedback": "Constructive feedback for the learner",
  "outputMatches": true/false
}

DO NOT OUTPUT ANYTHING OTHER THAN VALID JSON.
                    `;

                    const response = await window.claude.complete(prompt);
                    const evaluation = JSON.parse(response);

                    if (evaluation.isCorrect) {
                        completedLevels.add(currentLevel);
                        streak++;
                        showFeedback('success', 'ðŸŽ‰ Excellent! You completed this level!', {
                            explanation: evaluation.feedback
                        });
                    } else {
                        streak = 0;
                        showFeedback('error', 'Not quite right. Let\'s review your solution:', {
                            explanation: evaluation.feedback,
                            hint: evaluation.explanation,
                            expected: level.expectedOutput
                        });
                    }
                } else {
                    // Fallback to simple output comparison
                    const output = executeCode(userCode);
                    const isCorrect = output.trim() === level.expectedOutput.trim();

                    if (isCorrect) {
                        completedLevels.add(currentLevel);
                        streak++;
                        showFeedback('success', 'ðŸŽ‰ Excellent! You completed this level!', {
                            output: output
                        });
                    } else {
                        streak = 0;
                        showFeedback('error', 'Not quite right. Let\'s review your solution:', {
                            output: output,
                            expected: level.expectedOutput,
                            hint: level.hint
                        });
                    }
                }
            } catch (error) {
                console.error('Error evaluating code:', error);
                showFeedback('error', 'An error occurred while evaluating your code. Please try again.');
            } finally {
                // Re-enable run button
                runButton.disabled = false;
                saveState();
                updateUI();
                generateLevelGrid();
            }
        }

        function resetCode() {
            const level = levels.find(l => l.id === currentLevel);
            document.getElementById('code-editor').value = level.starterCode;
            hideFeedback();
            hideHint();
        }
    </script>
</body>
</html>